<table>
  <thead>
    <th>Good</th>
    <th>Producer</th>
    <th>Destination</th>
    <th class="clickable" (click)="sortByMiles()">Distance</th>
    <th class="clickable" (click)="sortByCost()">Cost</th>
    <th>production<br>per week</th>
    <th>demand<br>per week</th>
    <th>production<br>factor</th>
    <th>demand<br>factor</th>
    <th>(effective rate)</th>
    <th>last run</th>
    <th>next run</th>
    <th><!-- buttons --></th>
  </thead>
  <tbody>

    <!-- existing -->
    <tr *ngFor="let line of linesSorted$ | async">
      <td>{{ line.good }}</td>
      <td>{{ line.ruralProducer }}</td>
      <td>{{ line.destinationCity }}</td>
      <td class="align-right">{{ line.miles }}</td>
      <td class="align-right">{{ line.cost }}</td>
      <td class="align-right">{{ productionPerWeek$(line) | async | number:'.1-1' }}</td>
      <td class="align-right">{{ demandPerWeek$(line) | async | number:'.1-1' }}</td>
      <td class="align-right">{{ line.productionFactor ?? 1.0 | number:'.2-2' }}</td>
      <td class="align-right">{{ line.demandFactor ?? 1.0 | number:'.2-2' }}</td>
      <td class="align-right">{{ effectiveRate$(line) | async | number:'.1-1' }}</td>
      <td>{{ line.lastRun | date:'yyyy-MM-dd' }}</td>
      <td>{{ nextRun$(line) | async | date:'yyyy-MM-dd' }}</td>
      <td>
        <button (click)="runNow(line)">Run now</button>
      </td>
    </tr>

    <!-- new ones -->
    <tr>
      <td>
        <select [(ngModel)]="newGood">
          <option disabled></option>
          <option *ngFor="let good of goods$ | async" [ngValue]="good">{{ good }}</option>
        </select>
      </td>
      <td>
        <select [(ngModel)]="newRuralProducer">
          <option disabled></option>
          <option *ngFor="let rural of rurales$ | async" [ngValue]="rural">{{ rural.name }} ({{rural.product}})
          </option>
        </select>
      </td>
      <td>
        <select [(ngModel)]="newDestinationCity">
          <option disabled></option>
          <option *ngFor="let ciudad of ciudades$ | async" [ngValue]="ciudad">{{ ciudad.name }}</option>
        </select>
      </td>
      <td>
        <input class="medium-number" type="number" placeholder="miles" [(ngModel)]="newMiles">
      </td>
      <td>
        <input class="medium-number" type="number" placeholder="cost" [(ngModel)]="newCost">
      </td>
      <td colspan="8">
        <button
          (click)="addLine({ruralProducer: newRuralProducer!, good: newGood!, destinationCity: newDestinationCity!, miles: newMiles!, cost: newCost! })"
          [disabled]="!newRuralProducer || !newGood || !newDestinationCity || !newMiles || !newCost">Add</button>
      </td>
    </tr>
  </tbody>
</table>
